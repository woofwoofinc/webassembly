matrix:
  fast_finish: true
  allow_failures:
    - rust: nightly

  include:
    - language: rust
      rust:
        - stable
        - beta
        - nightly
      cache: cargo
      before_script:
        - |
          (cargo install rustfmt || true) &&
          export PATH=$HOME/.cargo/bin:$PATH

      script:
        - |
          cargo fmt -- --write-mode=diff &&
          cargo build &&
          cargo test
      addons:
        apt:
          sources:
            - kalakris-cmake
          packages:
            - cmake
            - libssl-dev

    - language: node_js
      node_js:
        - "6"
        - "8"
      cache: yarn
      script:
        - yarn build
